# InsightAI â€” Backend (Go)

**Backend enterprise em Go para a plataforma InsightAI**  
Seguro, auditÃ¡vel, multi-tenant e preparado para escala global.

---

## ğŸ“Œ VisÃ£o Geral

Este repositÃ³rio contÃ©m o **BACKEND em Go** do InsightAI.  
Ele Ã© a **autoridade central** de:

- SeguranÃ§a
- AutorizaÃ§Ã£o (RBAC)
- GovernanÃ§a de IA
- ExecuÃ§Ã£o de agentes
- Workflows auditÃ¡veis
- Auditoria imutÃ¡vel
- Multi-tenancy

ğŸ‘‰ **Nada crÃ­tico acontece no frontend.**  
ğŸ‘‰ **Nada confia no frontend.**

---

## ğŸ¯ Responsabilidades do Backend

O backend Ã© responsÃ¡vel por:

- Autenticar usuÃ¡rios e admins
- Resolver tenant em toda requisiÃ§Ã£o
- Aplicar RBAC multinÃ­vel
- Executar o InsightAI Engine
- Orquestrar agentes e workflows
- Executar aÃ§Ãµes com validaÃ§Ã£o
- Registrar auditoria imutÃ¡vel
- Emitir mÃ©tricas e logs
- Aplicar kill-switch automÃ¡tico

---

## ğŸ§  PrincÃ­pios Arquiteturais

1. **Backend Ã© a autoridade final**
2. **Negar por padrÃ£o**
3. **Tudo Ã© explÃ­cito**
4. **Nada pula camadas**
5. **Falhar seguro Ã© obrigatÃ³rio**
6. **Tudo Ã© auditÃ¡vel**
7. **Multi-tenant por design**

---

## ğŸ§± Stack TecnolÃ³gica

- **Go** (>= 1.22)
- HTTP API (REST/JSON)
- Arquitetura modular
- Logger estruturado (JSON)
- Observabilidade nativa
- Infra como cÃ³digo (fora deste repo)

---

## ğŸ“‚ Estrutura do Projeto

.
â”œâ”€ cmd/
â”‚ â””â”€ api/
â”‚ â””â”€ main.go # Bootstrap da aplicaÃ§Ã£o
â”‚
â”œâ”€ internal/
â”‚ â”œâ”€ config/ # ConfiguraÃ§Ã£o e env
â”‚ â”œâ”€ server/ # HTTP server
â”‚ â”œâ”€ middleware/ # Middlewares globais
â”‚ â”œâ”€ auth/ # AutenticaÃ§Ã£o
â”‚ â”œâ”€ rbac/ # AutorizaÃ§Ã£o
â”‚ â”œâ”€ tenant/ # Multi-tenancy
â”‚ â”œâ”€ audit/ # Auditoria imutÃ¡vel
â”‚ â”œâ”€ domain/ # Regras de negÃ³cio
â”‚ â”œâ”€ engine/ # InsightAI Engine
â”‚ â”œâ”€ agents/ # Agentes de IA
â”‚ â”œâ”€ workflows/ # Workflows
â”‚ â”œâ”€ actions/ # AÃ§Ãµes executÃ¡veis
â”‚ â”œâ”€ integrations/ # IntegraÃ§Ãµes externas
â”‚ â”œâ”€ observability/ # Logs, mÃ©tricas, alertas
â”‚ â””â”€ errors/ # Erros padronizados
â”‚
â”œâ”€ pkg/
â”‚ â””â”€ types/ # Tipos pÃºblicos (contratos)
â”‚
â”œâ”€ go.mod
â”œâ”€ go.sum
â””â”€ README.md


### Regras de Estrutura
- `cmd/` **apenas inicia** a aplicaÃ§Ã£o
- Toda lÃ³gica vive em `/internal`
- Nada fora do mÃ³dulo acessa `/internal`
- Nenhuma pasta genÃ©rica (`utils`, `helpers`)

---

## ğŸ” Pipeline ObrigatÃ³rio de ExecuÃ§Ã£o

Nenhuma requisiÃ§Ã£o pode pular este fluxo:

Request
â†’ Authentication
â†’ Tenant Resolution
â†’ RBAC Authorization
â†’ Policy Validation
â†’ Engine Decision
â†’ Action / Workflow Execution
â†’ Audit Log
â†’ Response


Falha em qualquer etapa â†’ **bloqueio imediato**.

---

## ğŸ” AutenticaÃ§Ã£o

- Token de acesso (curta duraÃ§Ã£o)
- Refresh token controlado
- MFA para perfis sensÃ­veis
- Admin preparado para FIDO2 (WebAuthn)

O backend sempre resolve:
- Quem Ã© o usuÃ¡rio
- Qual o tenant
- Quais permissÃµes possui

---

## ğŸ›¡ï¸ AutorizaÃ§Ã£o (RBAC)

RBAC Ã© aplicado por:
- UsuÃ¡rio
- Agente
- AÃ§Ã£o
- Recurso (documento, workflow, integraÃ§Ã£o)

âŒ Proibido:
```go
if user.Role == "admin" { ... }
âœ… ObrigatÃ³rio:

Authorize(ctx, AuthorizationInput{
  UserID:   userID,
  TenantID: tenantID,
  Action:   action,
  Resource: resource,
})
ğŸ§  InsightAI Engine (Backend)
O Engine:

Nunca recebe input direto do frontend

Nunca executa sem policy

Nunca acessa outro tenant

Sempre registra auditoria

Pipeline lÃ³gico:

Input â†’ Policy â†’ Agent â†’ Workflow â†’ Action â†’ Audit â†’ Output
ğŸ¤– Agentes
Agentes sÃ£o entidades isoladas:

JurÃ­dico

Financeiro

TÃ©cnico

Supervisor (governanÃ§a)

Cada agente possui:

Escopo fixo

PermissÃµes prÃ³prias

Prompt versionado

MÃ©tricas e auditoria dedicadas

ğŸ”„ Workflows
Workflows sÃ£o:

Multi-etapas

AuditÃ¡veis

PausÃ¡veis

ReversÃ­veis (quando aplicÃ¡vel)

Nenhuma automaÃ§Ã£o silenciosa Ã© permitida.

âš™ï¸ AÃ§Ãµes
AÃ§Ãµes sÃ£o contratos explÃ­citos:

Nome

Schema de input

ValidaÃ§Ã£o forte

PermissÃµes

Executor isolado

Rollback (se aplicÃ¡vel)

Nenhuma aÃ§Ã£o executa sem:

AutorizaÃ§Ã£o

Registro de auditoria

ğŸ§¾ Auditoria
Tudo Ã© auditado:

Login

Consulta

Resposta da IA

ExecuÃ§Ã£o de aÃ§Ã£o

Falhas

Bloqueios

Kill-switch

Logs:

Estruturados

ImutÃ¡veis

ExportÃ¡veis (SOC 2 / ISO)

ğŸ“Š Observabilidade
O backend emite:

Logs estruturados

MÃ©tricas de latÃªncia

MÃ©tricas de erro

Uso por tenant

Estimativa de custo

Sem dados sensÃ­veis.

ğŸŒ Multi-Tenancy
Regras absolutas:

tenantID sempre explÃ­cito

Nenhuma query sem tenant

Nenhuma cache compartilhada

Nenhuma memÃ³ria global

ViolaÃ§Ã£o disso Ã© falha crÃ­tica.

ğŸš¨ Agente Supervisor (Kill-Switch)
O Supervisor pode:

Suspender agentes

Pausar workflows

Bloquear tenants

Revogar tokens

Encerrar execuÃ§Ãµes

Sem intervenÃ§Ã£o humana prÃ©via.

ğŸ§ª Testes
Testes obrigatÃ³rios:

UnitÃ¡rios (domain, rbac)

UnitÃ¡rios (engine)

IntegraÃ§Ã£o (API)

Testes de abuso bÃ¡sicos

Sem testes â†’ sem deploy.

ğŸš€ Build & ExecuÃ§Ã£o
Build
go build ./cmd/api
Run (local)
go run ./cmd/api
Health Check
GET /health
ğŸ›‘ O Backend NÃƒO Faz
NÃ£o confia no frontend

NÃ£o executa lÃ³gica implÃ­cita

NÃ£o ignora auditoria

NÃ£o compartilha contexto

NÃ£o faz â€œatalhosâ€

ğŸ DefiniÃ§Ã£o de â€œProntoâ€
Um backend sÃ³ Ã© considerado pronto quando:

CÃ³digo idiomÃ¡tico Go

Erros tratados

Logs emitidos

Auditoria registrada

RBAC aplicado

Testes passando

DocumentaÃ§Ã£o atualizada

ğŸ“„ LicenÃ§a
Software proprietÃ¡rio.
Uso restrito conforme contrato comercial.

InsightAI Backend â€” Go, seguro e feito para durar.

